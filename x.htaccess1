
# ==============================================================
# CRIS ANN PASALUBONG CENTER (crisannshop.com)
# Production Deployment ‚Äî Genesis Commerce Stack
# ==============================================================

# Enable rewrite engine
RewriteEngine On

# ----------------------------------------------------------------------
# 1Ô∏è‚É£ FORCE HTTPS
# ----------------------------------------------------------------------
RewriteCond %{HTTPS} !=on
RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# ----------------------------------------------------------------------
# 2Ô∏è‚É£ CANONICAL DOMAIN (non-www)
# ----------------------------------------------------------------------
RewriteCond %{HTTP_HOST} ^www\.crisannshop\.com [NC]
RewriteRule ^(.*)$ https://crisannshop.com/$1 [L,R=301]

# ----------------------------------------------------------------------
# 3Ô∏è‚É£ ENTRYPOINTS
# ----------------------------------------------------------------------

# Root ‚Üí Shop Frontend
RewriteRule ^$ public/shop/index.php [L]

# /admin ‚Üí Admin Panel
RewriteCond %{REQUEST_URI} ^/admin [NC]
RewriteRule ^admin/?$ public/index.php [L]

# Allow direct access to public assets
RewriteCond %{REQUEST_URI} ^/public/assets/ [NC]
RewriteRule ^ - [L]

# ----------------------------------------------------------------------
# 4Ô∏è‚É£ FRONT CONTROLLER (optional for clean routes)
# If you later use SEO-friendly URLs like /product/123 or /about-us
# Uncomment these lines:
# ----------------------------------------------------------------------
# RewriteCond %{REQUEST_FILENAME} !-f
# RewriteCond %{REQUEST_FILENAME} !-d
# RewriteRule ^shop/(.*)$ public/shop/$1 [L,QSA]
# RewriteRule ^(.*)$ public/shop/index.php [L,QSA]

# ----------------------------------------------------------------------
# 5Ô∏è‚É£ SECURITY HARDENING
# ----------------------------------------------------------------------

# üö´ Block direct access to internal folders
RedirectMatch 403 ^/(classes|config|functions|storage|\.git|vendor|tests|docs|backup)
RedirectMatch 403 (^|/)\.env$
RedirectMatch 403 (^|/)\.git
RedirectMatch 403 (^|/)composer\.(json|lock)
RedirectMatch 403 (^|/)(package|yarn)\.json
RedirectMatch 403 (^|/)README\.md

# Prevent directory listing
Options -Indexes

# ----------------------------------------------------------------------
# 6Ô∏è‚É£ CACHING & PERFORMANCE
# ----------------------------------------------------------------------
<IfModule mod_headers.c>
    # Cache static files for 30 days
    <FilesMatch "\.(jpg|jpeg|png|gif|svg|webp|css|js|ico|woff2?|ttf|eot|mp4|webm)$">
        Header set Cache-Control "max-age=2592000, public"
    </FilesMatch>

    # CORS for fonts
    <FilesMatch "\.(woff2?|ttf|eot)$">
        Header set Access-Control-Allow-Origin "*"
    </FilesMatch>
</IfModule>

# ----------------------------------------------------------------------
# 7Ô∏è‚É£ PWA SUPPORT (Manifest & Service Worker)
# ----------------------------------------------------------------------
<Files "sw.js">
    Header set Service-Worker-Allowed "/"
</Files>
<Files "manifest.json">
    Header set Content-Type "application/manifest+json"
</Files>

# ----------------------------------------------------------------------
# 8Ô∏è‚É£ DEFAULT DOCUMENTS
# ----------------------------------------------------------------------
DirectoryIndex index.php index.html

# ==============================================================
# END OF FILE
# ==============================================================

